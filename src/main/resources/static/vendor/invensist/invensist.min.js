$.isDefined = function(variable) {
	return typeof variable !== 'undefined';
};

var Form = Class.extend(function(){
	this.constructor = function($form){
		this.form = $form;
	};

	this.refresh = function() {
		var f = this;
		this.form.find("*[name]").val("");
		this.form.validator('destroy').validator().on('submit', function (e) {
			if (e.isDefaultPrevented()) {
				console.log("Invalid Form");
			} else {
				var valid = !$.isDefined(f._customValidationHandler) || f._customValidationHandler(f.getData());
				if (valid) {
					if (typeof f._submitHandler !== 'undefined') {
						f._submitHandler(f.getData());
					}
				} else {
					e.preventDefault();
				}
			}
		});
	};

	this.onSubmit = function(submitHandler) {
		this._submitHandler = submitHandler;
	};
	
	this.customValidationHandler = function(handler) {
		this._customValidationHandler = handler;
	};
	
	this.setData = function(data) {
		if(data) {
			for(var prop in data) {
				this.form.find("*[name='" + prop + "']").each(function(){
					$(this).val(data[prop]);
					if($(this).is(':checkbox')) {
						$(this).attr("checked",data[prop]);
					}
				});
			}
		}
	};

	this.getData = function() {
		var formArray = this.form.serializeArray();
		alert(formArray);
		var result = {};
		for (var i = 0; i < formArray.length; i++){
			result[formArray[i]['name']] = formArray[i]['value'];
		}
		return result;		
	};
});

